steps:
- name: alpine
  entrypoint: /bin/sh
  args: ["-c", "cp -r /workspace/* /workspace32"]
  waitFor: ["-"]
  volumes:
  - name: w32
    path: /workspace32
- name: gcr.io/$PROJECT_ID/buildenv:32
  args: ["bash", "scripts/bootstrap.sh", "32"]
  dir: /workspace32
  volumes:
  - name: w32
    path: /workspace32
- name: gcr.io/$PROJECT_ID/buildenv:32
  args: ["ninja", "-C", "/workspace32/build", "-k", "100"]
  volumes:
  - name: w32
    path: /workspace32
- name: alpine
  entrypoint: /bin/sh
  args: ["-c", "cp -r /workspace/* /workspace64"]
  waitFor: ["-"]
  volumes:
  - name: w64
    path: /workspace64
- name: gcr.io/$PROJECT_ID/buildenv:64
  args: ["bash", "scripts/bootstrap.sh", "64"]
  dir: /workspace64
  volumes:
  - name: w64
    path: /workspace64
- name: gcr.io/$PROJECT_ID/buildenv:64
  args: ["ninja", "-C", "/workspace64/build", "-k", "100"]
  volumes:
  - name: w64
    path: /workspace64
- id: Store build results
  name: gcr.io/cloud-builders/gsutil
  args:
  - cp
  - /workspace32/build/src/broadcom/vulkan/libvulkan_broadcom.so
  - /workspace32/build/src/broadcom/vulkan/dev_icd.armv7hl.json
  - /workspace32/build/meson-logs/meson-log.txt
  - gs://v3dvk-build-results/32
  volumes:
  - name: w32
    path: /workspace32
options:
  machineType: N1_HIGHCPU_8
